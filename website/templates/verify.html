<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Verification</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .debug-info{background:#f8f9fa;border-left:4px solid #3498db;padding:15px;margin:15px 0;border-radius:5px;font-family:monospace;font-size:12px;display:none}
        .debug-toggle{background:#3498db;color:#fff;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:11px;float:right}
        .error-details{background:#f8d7da;color:#721c24;padding:10px;border-radius:5px;margin:10px 0;font-size:12px;display:none}
        .verification-status{background:#e8f5e9;padding:15px;border-radius:8px;margin:15px 0;border-left:4px solid #2ecc71}
        .btn-discord{display:block;background:#5865F2;color:white;padding:15px;border-radius:8px;text-decoration:none;font-size:18px;font-weight:bold;text-align:center}
        .btn-verify{width:100%;padding:15px;background:#5865f2;color:white;border:none;border-radius:8px;font-size:1rem;font-weight:bold;cursor:pointer}
        .btn-verify:disabled{background:#ccc}
        .btn-logout{display:block;background:#e74c3c;color:white;padding:10px;border-radius:6px;text-decoration:none;text-align:center;margin-top:10px}
        .user-info{display:flex;justify-content:center;align-items:center;background:#f8f9fa;padding:15px;border-radius:10px}
        .avatar-placeholder{width:60px;height:60px;background:#5865F2;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-size:24px;margin-right:15px}
    </style>
</head>

<body>

<div id="app-data"
     data-has-discord-user="{{ 'true' if discord_user else 'false' }}"
     data-is-verified="{{ 'true' if is_verified else 'false' }}"
     data-csrf-token="{{ csrf_token }}">
</div>

<div class="verification-container">
<div class="verification-card">

<div class="verification-header">
    <h1>Discord Verification</h1>
    <button class="debug-toggle">Debug</button>
</div>

<div id="debugInfo" class="debug-info">
    Discord User: {{ 'YES' if discord_user else 'NO' }}<br>
    Verified: {{ 'YES' if is_verified else 'NO' }}<br>
    CSRF: {{ 'OK' if csrf_token else 'MISSING' }}
</div>

{% if not discord_user %}
    <a href="{{ url_for('auth_discord') }}" class="btn-discord">
        <i class="fab fa-discord"></i> Login with Discord
    </a>

{% elif is_verified %}
    <div class="verification-status">
        <h3>âœ… Already Verified</h3>
        <p>{{ discord_user.full_username }}</p>
        <a href="{{ url_for('auth_logout') }}" class="btn-logout">Use another account</a>
    </div>

{% else %}
    <div class="user-info">
        <div class="avatar-placeholder"><i class="fas fa-user"></i></div>
        <div>
            <strong>{{ discord_user.full_username }}</strong><br>
            Ready to verify
        </div>
    </div>

    <button id="startVerification" class="btn-verify">
        <i class="fas fa-check-circle"></i> Start Verification
    </button>

    <a href="{{ url_for('auth_logout') }}" class="btn-logout">Not you?</a>
{% endif %}

<div id="verificationResult"></div>
<div id="errorDetails" class="error-details"></div>

</div>
</div>

<script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/verify.js') }}" defer></script>
</body>
</html>
